{"version":3,"sources":["../js/blocks-films.js"],"names":["blockFilmsWrapper","document","getElementById","innerHTML","renderFilmblock","posterUrl","title","id","wrapper","createElement","classList","add","style","backgroundImage","backgroundSize","playbillGray","playbillGreen","playbillTitle","textContent","playbillSubtitle","href","append","fetchBlockFilms","topFilmsRequest","result","json","data","request","filmblocksMap","Map","films","forEach","film","posterUrlPreview","nameRu","filmId","filmblock","set","push","Promise","resolve","reject","filmsDetailsRequest","detailResult","detailsData","description","all","elements","values","slice"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,iBAAiB,GAAGC,QAAQ,CAACC,cAAT,CAAwB,wBAAxB,CAA1B;AACAF,iBAAiB,CAACG,SAAlB,GAA8B,EAA9B;;AAGA,SAASC,eAAT,CAAyBC,SAAzB,EAAoCC,KAApC,EAA2CC,EAA3C,EAA+C;AAC3C,MAAMC,OAAO,GAAGP,QAAQ,CAACQ,aAAT,CAAuB,GAAvB,CAAhB;AACAD,EAAAA,OAAO,CAACE,SAAR,CAAkBC,GAAlB,CAAsB,QAAtB;AACAH,EAAAA,OAAO,CAACI,KAAR,CAAcC,eAAd,GAAgCR,SAAhC;AACAG,EAAAA,OAAO,CAACI,KAAR,CAAcE,cAAd,GAA+B,WAA/B;AACA,MAAMC,YAAY,GAAGd,QAAQ,CAACQ,aAAT,CAAuB,KAAvB,CAArB;AACAM,EAAAA,YAAY,CAACL,SAAb,CAAuBC,GAAvB,CAA2B,gBAA3B;AACA,MAAMK,aAAa,GAAGf,QAAQ,CAACQ,aAAT,CAAuB,KAAvB,CAAtB;AACAO,EAAAA,aAAa,CAACN,SAAd,CAAwBC,GAAxB,CAA4B,iBAA5B;AACA,MAAMM,aAAa,GAAGhB,QAAQ,CAACQ,aAAT,CAAuB,MAAvB,CAAtB;AACAQ,EAAAA,aAAa,CAACP,SAAd,CAAwBC,GAAxB,CAA4B,iBAA5B;AACAM,EAAAA,aAAa,CAACC,WAAd,GAA4BZ,KAA5B;AACA,MAAMa,gBAAgB,GAAGlB,QAAQ,CAACQ,aAAT,CAAuB,MAAvB,CAAzB;AACAU,EAAAA,gBAAgB,CAACT,SAAjB,CAA2BC,GAA3B,CAA+B,oBAA/B,EAb2C,CAc3C;;AACAH,EAAAA,OAAO,CAACY,IAAR,yBAA8Bb,EAA9B;AACAC,EAAAA,OAAO,CAACa,MAAR,CAAeN,YAAf;AACAA,EAAAA,YAAY,CAACM,MAAb,CAAoBL,aAApB;AACAA,EAAAA,aAAa,CAACK,MAAd,CAAqBJ,aAArB,EAAoCE,gBAApC;AAIA,SAAO,CAACX,OAAD,EAAUW,gBAAV,CAAP;AACH;;AAED,IAAMG,eAAe;AAAA,qEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACCC,eAAe,EADhB;;AAAA;AACdC,YAAAA,MADc;AAAA;AAAA,mBAGDA,MAAM,CAACC,IAAP,EAHC;;AAAA;AAGdC,YAAAA,IAHc;AAKdC,YAAAA,OALc,GAKJ,EALI;AAMdC,YAAAA,aANc,GAME,IAAIC,GAAJ,EANF;AAQpBH,YAAAA,IAAI,CAACI,KAAL,CAAWC,OAAX;AAAA,kFAAmB,kBAAOC,IAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,2CACuB5B,eAAe,eAAQ4B,IAAI,CAACC,gBAAb,QAAkCD,IAAI,CAACE,MAAvC,EAA+CF,IAAI,CAACG,MAApD,CADtC,2DACRC,SADQ,yBACGjB,gBADH;AAGfS,wBAAAA,aAAa,CAACS,GAAd,CAAkBL,IAAI,CAACG,MAAvB,EAA+BC,SAA/B;AAEAT,wBAAAA,OAAO,CAACW,IAAR,CAAa,IAAIC,OAAJ;AAAA,8FAAY,iBAAMC,OAAN,EAAeC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CACMC,mBAAmB,CAACV,IAAI,CAACG,MAAN,CADzB;;AAAA;AACfQ,oCAAAA,YADe;AAAA;AAAA,2CAEKA,YAAY,CAAClB,IAAb,EAFL;;AAAA;AAEfmB,oCAAAA,WAFe;AAIfC,oCAAAA,WAJe,GAIDD,WAAW,CAAClB,IAAZ,CAAiBmB,WAJhB;;AAOrB,wCAAG,CAACA,WAAJ,EAAiB;AACbjB,sCAAAA,aAAa,UAAb,CAAqBI,IAAI,CAACG,MAA1B;AACH,qCAFD,MAEO;AACHhB,sCAAAA,gBAAgB,CAACD,WAAjB,GAA+B2B,WAA/B;AACH;;AACDL,oCAAAA,OAAO;;AAZc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAZ;;AAAA;AAAA;AAAA;AAAA,4BAAb;;AALe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAnB;;AAAA;AAAA;AAAA;AAAA;AARoB;AAAA,mBA6BdD,OAAO,CAACO,GAAR,CAAYnB,OAAZ,CA7Bc;;AAAA;AA8BpB;;AACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AAEUoB,YAAAA,QAxCc,GAwCH,mBAAInB,aAAa,CAACoB,MAAd,EAAJ,EAA4BC,KAA5B,CAAkC,CAAlC,EAAqC,CAArC,CAxCG;AA0CpBjD,YAAAA,iBAAiB,CAACqB,MAAlB,OAAArB,iBAAiB,qBAAW+C,QAAX,EAAjB;;AA1CoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAfzB,eAAe;AAAA;AAAA;AAAA,GAArB;;AA6CAA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["const blockFilmsWrapper = document.getElementById('film-1__films__wrapper');\r\nblockFilmsWrapper.innerHTML = '';\r\n\r\n\r\nfunction renderFilmblock(posterUrl, title, id) {\r\n    const wrapper = document.createElement('a');\r\n    wrapper.classList.add('film-1');\r\n    wrapper.style.backgroundImage = posterUrl;\r\n    wrapper.style.backgroundSize = \"100% auto\";\r\n    const playbillGray = document.createElement('div');\r\n    playbillGray.classList.add('playbill__gray');\r\n    const playbillGreen = document.createElement('div');\r\n    playbillGreen.classList.add('playbill__green');\r\n    const playbillTitle = document.createElement('span');\r\n    playbillTitle.classList.add('playbill__title');\r\n    playbillTitle.textContent = title;\r\n    const playbillSubtitle = document.createElement('span');\r\n    playbillSubtitle.classList.add('playbill__subtitle');\r\n    //playbillSubtitle.textContent = '...Ждите';\r\n    wrapper.href = `/single/?id=${id}`;\r\n    wrapper.append(playbillGray);\r\n    playbillGray.append(playbillGreen);\r\n    playbillGreen.append(playbillTitle, playbillSubtitle);  \r\n    \r\n\r\n\r\n    return [wrapper, playbillSubtitle];  \r\n}\r\n\r\nconst fetchBlockFilms = async () => {\r\n    const result = await topFilmsRequest()\r\n    //.then(data => data.json())\r\n    const data = await result.json();\r\n\r\n    const request = [];\r\n    const filmblocksMap = new Map();\r\n\r\n    data.films.forEach(async (film) => {\r\n        const [filmblock, playbillSubtitle] = renderFilmblock(`url(${film.posterUrlPreview})`, film.nameRu, film.filmId)\r\n        \r\n        filmblocksMap.set(film.filmId, filmblock)\r\n\r\n        request.push(new Promise(async(resolve, reject) => {\r\n            const detailResult = await filmsDetailsRequest(film.filmId);\r\n            const detailsData = await detailResult.json();\r\n\r\n            const description = detailsData.data.description;\r\n            \r\n         \r\n            if(!description) {\r\n                filmblocksMap.delete(film.filmId);\r\n            } else {\r\n                playbillSubtitle.textContent = description;\r\n            }\r\n            resolve();\r\n        })); \r\n        \r\n    })\r\n    await Promise.all(request);\r\n    //blockFilmsWrapper.append(filmblock);\r\n    /*let i = 0;\r\n    for (const [id, element] of filmblocksMap) {\r\n        blockFilmsWrapper.append(element)\r\n        i++;\r\n\r\n        if (i >= 9){\r\n            break;\r\n        }\r\n    }*/\r\n    const elements = [...filmblocksMap.values()].slice(0, 9);\r\n\r\n    blockFilmsWrapper.append(...elements);\r\n}\r\n\r\nfetchBlockFilms();\r\n/*\r\nfetch('https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_AWAIT_FILMS&page=1', {\r\n        headers: {\r\n            ...apiHeaders\r\n        },\r\n        cors: 'no-cors'\r\n    })\r\n    .then(data => data.json())\r\n    .then(data => {data.films.forEach((film) => {\r\n            const id = `blocks-films-desk-${film.filmId}`\r\n            blockFilmsWrapper.innerHTML += `\r\n            <a class=\"film-1\" style=\"background-image:url(${film.posterUrlPreview}); background-size: 100% auto;\" href=\"\" onclick=\"return false;\"  target=\"_blank\">\r\n                <div class=\"playbill__gray\">\r\n                    <div class=\"playbill__green\">\r\n                        <span class=\"playbill__title\">${film.nameRu}<br></span>\r\n                        <span id=\"${id}\" class=\"playbill__subtitle\"> ...Ждите</span> \r\n                    </div>\r\n                </div>    \r\n            </a>\r\n            `\r\n            fetch(`https://kinopoiskapiunofficial.tech/api/v2.1/films/${film.filmId}`, {\r\n                    headers: {\r\n                        ...apiHeaders\r\n                    },\r\n                    cors: 'no-cors'\r\n            })\r\n            .then(data => data.json())\r\n            .then(({data: {description}}) => {\r\n                const desc = document.getElementById(id);\r\n                desc.innerHTML = description;\r\n                if (!description) {\r\n                    const root = desc.parentNode.parentNode.parentNode;\r\n                    blockFilmsWrapper.removeChild(root);\r\n                }\r\n            })\r\n        })\r\n    })\r\n*/"],"file":"blocks-films.js"}