{"version":3,"sources":["../js/blocks-films.js"],"names":["blockFilmsWrapper","document","getElementById","innerHTML","kinopoiskapiunofficialRequest","url","fetch","headers","cors","topFilmsRequest","filmsDetailsRequest","id","renderFilmblock","posterUrl","title","wrapper","createElement","classList","add","style","backgroundImage","backgroundSize","playbillGray","playbillGreen","playbillTitle","textContent","playbillSubtitle","append","fetchBlockFilms","result","json","data","request","filmblocksMap","Map","films","forEach","film","posterUrlPreview","nameRu","filmblock","set","filmId","push","Promise","resolve","reject","detailResult","detailsData","description","all","elements","values","slice"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,iBAAiB,GAAGC,QAAQ,CAACC,cAAT,CAAwB,wBAAxB,CAA1B;AACAF,iBAAiB,CAACG,SAAlB,GAA8B,EAA9B;;AAEA,IAAMC,6BAA6B,GAAG,SAAhCA,6BAAgC,CAACC,GAAD,EAAS;AAC3C,SAAOC,KAAK,CAACD,GAAD,EAAM;AACdE,IAAAA,OAAO,EAAE;AACL,gBAAU,kBADL;AAEL,mBAAa;AAFR,KADK;AAKdC,IAAAA,IAAI,EAAE;AALQ,GAAN,CAAZ;AAOH,CARD;;AAUA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC1B,SAAOL,6BAA6B,CAAC,oFAAD,CAApC;AACH,CAFD;;AAGA,IAAMM,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,EAAD,EAAQ;AAChC,SAAOP,6BAA6B,8DAAuDO,EAAvD,EAApC;AACH,CAFD;;AAIA,SAASC,eAAT,CAAyBC,SAAzB,EAAoCC,KAApC,EAA2C;AACvC,MAAMC,OAAO,GAAGd,QAAQ,CAACe,aAAT,CAAuB,GAAvB,CAAhB;AACAD,EAAAA,OAAO,CAACE,SAAR,CAAkBC,GAAlB,CAAsB,QAAtB;AACAH,EAAAA,OAAO,CAACI,KAAR,CAAcC,eAAd,GAAgCP,SAAhC;AACAE,EAAAA,OAAO,CAACI,KAAR,CAAcE,cAAd,GAA+B,WAA/B;AACA,MAAMC,YAAY,GAAGrB,QAAQ,CAACe,aAAT,CAAuB,KAAvB,CAArB;AACAM,EAAAA,YAAY,CAACL,SAAb,CAAuBC,GAAvB,CAA2B,gBAA3B;AACA,MAAMK,aAAa,GAAGtB,QAAQ,CAACe,aAAT,CAAuB,KAAvB,CAAtB;AACAO,EAAAA,aAAa,CAACN,SAAd,CAAwBC,GAAxB,CAA4B,iBAA5B;AACA,MAAMM,aAAa,GAAGvB,QAAQ,CAACe,aAAT,CAAuB,MAAvB,CAAtB;AACAQ,EAAAA,aAAa,CAACP,SAAd,CAAwBC,GAAxB,CAA4B,iBAA5B;AACAM,EAAAA,aAAa,CAACC,WAAd,GAA4BX,KAA5B;AACA,MAAMY,gBAAgB,GAAGzB,QAAQ,CAACe,aAAT,CAAuB,MAAvB,CAAzB;AACAU,EAAAA,gBAAgB,CAACT,SAAjB,CAA2BC,GAA3B,CAA+B,oBAA/B,EAbuC,CAcvC;;AAEAH,EAAAA,OAAO,CAACY,MAAR,CAAeL,YAAf;AACAA,EAAAA,YAAY,CAACK,MAAb,CAAoBJ,aAApB;AACAA,EAAAA,aAAa,CAACI,MAAd,CAAqBH,aAArB,EAAoCE,gBAApC;AAEA,SAAO,CAACX,OAAD,EAAUW,gBAAV,CAAP;AACH;;AAED,IAAME,eAAe;AAAA,qEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACCnB,eAAe,EADhB;;AAAA;AACdoB,YAAAA,MADc;AAAA;AAAA,mBAGDA,MAAM,CAACC,IAAP,EAHC;;AAAA;AAGdC,YAAAA,IAHc;AAKdC,YAAAA,OALc,GAKJ,EALI;AAMdC,YAAAA,aANc,GAME,IAAIC,GAAJ,EANF;AAQpBH,YAAAA,IAAI,CAACI,KAAL,CAAWC,OAAX;AAAA,kFAAmB,kBAAOC,IAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,2CACuBzB,eAAe,eAAQyB,IAAI,CAACC,gBAAb,QAAkCD,IAAI,CAACE,MAAvC,CADtC,2DACRC,SADQ,yBACGd,gBADH;AAGfO,wBAAAA,aAAa,CAACQ,GAAd,CAAkBJ,IAAI,CAACK,MAAvB,EAA+BF,SAA/B;AAEAR,wBAAAA,OAAO,CAACW,IAAR,CAAa,IAAIC,OAAJ;AAAA,8FAAY,iBAAMC,OAAN,EAAeC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CACMpC,mBAAmB,CAAC2B,IAAI,CAACK,MAAN,CADzB;;AAAA;AACfK,oCAAAA,YADe;AAAA;AAAA,2CAEKA,YAAY,CAACjB,IAAb,EAFL;;AAAA;AAEfkB,oCAAAA,WAFe;AAIfC,oCAAAA,WAJe,GAIDD,WAAW,CAACjB,IAAZ,CAAiBkB,WAJhB;;AAOrB,wCAAG,CAACA,WAAJ,EAAiB;AACbhB,sCAAAA,aAAa,UAAb,CAAqBI,IAAI,CAACK,MAA1B;AACH,qCAFD,MAEO;AACHhB,sCAAAA,gBAAgB,CAACD,WAAjB,GAA+BwB,WAA/B;AACH;;AACDJ,oCAAAA,OAAO;;AAZc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAZ;;AAAA;AAAA;AAAA;AAAA,4BAAb;;AALe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAnB;;AAAA;AAAA;AAAA;AAAA;AARoB;AAAA,mBA6BdD,OAAO,CAACM,GAAR,CAAYlB,OAAZ,CA7Bc;;AAAA;AA8BpB;;AACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AAEUmB,YAAAA,QAxCc,GAwCH,mBAAIlB,aAAa,CAACmB,MAAd,EAAJ,EAA4BC,KAA5B,CAAkC,CAAlC,EAAqC,CAArC,CAxCG;AA0CpBrD,YAAAA,iBAAiB,CAAC2B,MAAlB,OAAA3B,iBAAiB,qBAAWmD,QAAX,EAAjB;;AA1CoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAfvB,eAAe;AAAA;AAAA;AAAA,GAArB;;AA6CAA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["const blockFilmsWrapper = document.getElementById('film-1__films__wrapper');\r\nblockFilmsWrapper.innerHTML = '';\r\n\r\nconst kinopoiskapiunofficialRequest = (url) => {\r\n    return fetch(url, {\r\n        headers: {\r\n            'accept': 'application/json',\r\n            'X-API-KEY': '1eb612fe-4b9a-4151-94c8-1e24e42c687b',\r\n        },\r\n        cors: 'no-cors'\r\n    });\r\n}\r\n\r\nconst topFilmsRequest = () => {\r\n    return kinopoiskapiunofficialRequest('https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_AWAIT_FILMS&page=1')\r\n}\r\nconst filmsDetailsRequest = (id) => {\r\n    return kinopoiskapiunofficialRequest(`https://kinopoiskapiunofficial.tech/api/v2.1/films/${id}`)\r\n}\r\n\r\nfunction renderFilmblock(posterUrl, title) {\r\n    const wrapper = document.createElement('a');\r\n    wrapper.classList.add('film-1');\r\n    wrapper.style.backgroundImage = posterUrl;\r\n    wrapper.style.backgroundSize = \"100% auto\";\r\n    const playbillGray = document.createElement('div');\r\n    playbillGray.classList.add('playbill__gray');\r\n    const playbillGreen = document.createElement('div');\r\n    playbillGreen.classList.add('playbill__green');\r\n    const playbillTitle = document.createElement('span');\r\n    playbillTitle.classList.add('playbill__title');\r\n    playbillTitle.textContent = title;\r\n    const playbillSubtitle = document.createElement('span');\r\n    playbillSubtitle.classList.add('playbill__subtitle');\r\n    //playbillSubtitle.textContent = '...Ждите';\r\n                    \r\n    wrapper.append(playbillGray);\r\n    playbillGray.append(playbillGreen);\r\n    playbillGreen.append(playbillTitle, playbillSubtitle);  \r\n\r\n    return [wrapper, playbillSubtitle];  \r\n}\r\n\r\nconst fetchBlockFilms = async () => {\r\n    const result = await topFilmsRequest()\r\n    //.then(data => data.json())\r\n    const data = await result.json();\r\n\r\n    const request = [];\r\n    const filmblocksMap = new Map();\r\n\r\n    data.films.forEach(async (film) => {\r\n        const [filmblock, playbillSubtitle] = renderFilmblock(`url(${film.posterUrlPreview})`, film.nameRu)\r\n        \r\n        filmblocksMap.set(film.filmId, filmblock)\r\n\r\n        request.push(new Promise(async(resolve, reject) => {\r\n            const detailResult = await filmsDetailsRequest(film.filmId);\r\n            const detailsData = await detailResult.json();\r\n\r\n            const description = detailsData.data.description;\r\n            \r\n         \r\n            if(!description) {\r\n                filmblocksMap.delete(film.filmId);\r\n            } else {\r\n                playbillSubtitle.textContent = description;\r\n            }\r\n            resolve();\r\n        })); \r\n        \r\n    })\r\n    await Promise.all(request);\r\n    //blockFilmsWrapper.append(filmblock);\r\n    /*let i = 0;\r\n    for (const [id, element] of filmblocksMap) {\r\n        blockFilmsWrapper.append(element)\r\n        i++;\r\n\r\n        if (i >= 9){\r\n            break;\r\n        }\r\n    }*/\r\n    const elements = [...filmblocksMap.values()].slice(0, 9);\r\n\r\n    blockFilmsWrapper.append(...elements);\r\n}\r\n\r\nfetchBlockFilms();\r\n/*\r\nfetch('https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_AWAIT_FILMS&page=1', {\r\n        headers: {\r\n            ...apiHeaders\r\n        },\r\n        cors: 'no-cors'\r\n    })\r\n    .then(data => data.json())\r\n    .then(data => {data.films.forEach((film) => {\r\n            const id = `blocks-films-desk-${film.filmId}`\r\n            blockFilmsWrapper.innerHTML += `\r\n            <a class=\"film-1\" style=\"background-image:url(${film.posterUrlPreview}); background-size: 100% auto;\" href=\"\" onclick=\"return false;\"  target=\"_blank\">\r\n                <div class=\"playbill__gray\">\r\n                    <div class=\"playbill__green\">\r\n                        <span class=\"playbill__title\">${film.nameRu}<br></span>\r\n                        <span id=\"${id}\" class=\"playbill__subtitle\"> ...Ждите</span> \r\n                    </div>\r\n                </div>    \r\n            </a>\r\n            `\r\n            fetch(`https://kinopoiskapiunofficial.tech/api/v2.1/films/${film.filmId}`, {\r\n                    headers: {\r\n                        ...apiHeaders\r\n                    },\r\n                    cors: 'no-cors'\r\n            })\r\n            .then(data => data.json())\r\n            .then(({data: {description}}) => {\r\n                const desc = document.getElementById(id);\r\n                desc.innerHTML = description;\r\n                if (!description) {\r\n                    const root = desc.parentNode.parentNode.parentNode;\r\n                    blockFilmsWrapper.removeChild(root);\r\n                }\r\n            })\r\n        })\r\n    })\r\n*/"],"file":"blocks-films.js"}